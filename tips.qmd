# Tips {.unnumbered}

## 管道操作%>%

为什么R要这样写代码？`%>%`（pip operator）到底什么意思？
参考[R语言高效的管道操作magrittr | 粉丝日志 (fens.me)](http://blog.fens.me/r-magrittr/)


`%>%`看我代码中频繁出现， 这个操作符只有在加载`magrittr`后才能用。

我们先看一个简单的程序

1. 取1000个随机数符合，符合正态分布。
2. 求这个1000个数的绝对值，同时乘以50。
3. 把结果组成一个100*100列的方阵。
4. 计算方阵中每行的均值，并四舍五入保留到整数。
5. 画出直方图。

```{r}
#| echo: true

# 设置随机种子
set.seed(101)

# 开始 
n1<-rnorm(1000)            # 第1步
n2<-abs(n1)*50              # 第2步
n3<-matrix(n2,ncol = 100)   # 第3步
n4<-round(rowMeans(n3))     # 第4步
hist(n4)                 # 第5步
```

上面的代码写法是，每一行实现一个条件，但中间多了不少的**临时变量**。这无疑额外创建了很多没用的变量，对计算机来讲，就是垃圾变量占用内存，对于设计者来讲，看起来眼花。

想一想，还有没有其他写法？

我们看看下面这个，这是不同的嵌套，一层一层，将5步，一句语法实现。

```{r}
#| echo: true

set.seed(101)
hist(round(rowMeans(matrix(abs(rnorm(1000))*50,ncol=100))))
```

::: callout-warning
结果是一样。但这个写法，会让人觉得有点崩溃，一层套一层，稍有不慎，就少个括号，并且读起来半天才知道是做什么的。
:::

为了让代码读起来更像**人话**，我们就用到`%>%`，避免了创建一些无意义的中间变量，又看起来步骤分明。从里到外，一步一步，就像管道一样。


```{r}
#| echo: true

# 加载magrittr
library(magrittr)
# 设置随机种子
set.seed(101)

# 开始
rnorm(1000) %>%
  abs %>% `*` (50)  %>%
  matrix(ncol=100)  %>%
  rowMeans %>% round %>% 
  hist
```

看起来好爽。每一步都很清晰。

::: callout-note
magrittr包，主要定义了4个管道操作符，分另是%>%, %T>%, %$% 和 %<>%。其中，操作符%>%是最常用的，其他3个操作符，与%>%类似，在特殊的使用场景会起到更好的作用。请大家自学
:::
## 为什么要用Quarto 或R Markdown

